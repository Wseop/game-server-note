# Listener
- Listen Socket 초기화 (Bind, Listen)
- `AcceptAsync()`를 사용하여 비동기로 Accept를 수행하고 접속한 클라이언트의 소켓을 반환

## 멤버 변수
```c#
Socket listenSocket;
SocketAsyncEventArgs acceptArgs;
Action<Socket> onAcceptHandler;
```
- acceptArgs
  - `AcceptAsync()`의 인자.
  - 재사용이 가능하며, 재사용시 `AcceptSocket` 값을 초기화 시켜주어야 함.
  - `Completed`에 `AcceptAsync()` 완료시 호출될 함수를 추가.
- onAcceptHandler
  - 접속한 클라이언트의 소켓을 전달받아 처리하는 함수. Listener의 외부에서 정의하여 넘겨줌.

## Constructor
```c#
public Listener(IPEndPoint endPoint, Action<Socket> onAcceptHandler)
{ 
    listenSocket = new Socket(endPoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp);
    listenSocket.Bind(endPoint);
    listenSocket.Listen(10);

    acceptArgs = new SocketAsyncEventArgs();
    acceptArgs.Completed += new EventHandler<SocketAsyncEventArgs>(OnAcceptCompleted);

    this.onAcceptHandler = onAcceptHandler;
}
```

## StartAccept()
```c#
public void StartAccept()
{
    acceptArgs.AcceptSocket = null;

    if (listenSocket.AcceptAsync(acceptArgs) == false)
    {
        OnAcceptCompleted(null, acceptArgs);
    }
}
```
- `AcceptAsync()`를 호출하여 비동기로 Accept를 시작.
- 반환값(pending)이 false이면 대기없이 바로 완료가 된 상황. `OnAcceptCompleted`를 직접 호출.

## OnAcceptCompleted()
```c#
void OnAcceptCompleted(object sender, SocketAsyncEventArgs args)
{
    if (args.SocketError == SocketError.Success)
    {
        onAcceptHandler.Invoke(args.AcceptSocket);
    }
    else 
    {
        Console.WriteLine(args.SocketError.ToString());
    }

    StartAccept();
}
```
- `AcceptAsync()` 완료시 호출되는 함수.
- 성공적으로 완료되었다면, 클라이언트 소켓 (`args.AcceptSocket`)을 외부에 전달.
- 마지막으로 `StartAccept()`를 호출하여 다시 Accept를 시작.
